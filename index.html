<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root{--wa-dark-bg:#111B21;--wa-dark-header-bg:#202C33;--wa-dark-text-primary:#E9EDEF;--wa-dark-text-secondary:#8696A0;--wa-green-accent:#00A884;--wa-dark-selection:#2a3942;--font-family:'Roboto',sans-serif;}
        html,body{height:100%;margin:0;padding:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;}
        body{font-family:var(--font-family);background-color:#0b141a;display:flex;justify-content:center;align-items:center;height:100vh;}
        .whatsapp-container{width:100%;max-width:450px;height:100%;max-height:90vh;background-color:var(--wa-dark-bg);display:flex;flex-direction:column;box-shadow:0 5px 25px rgba(0,0,0,0.5);border-radius:8px;overflow:hidden;position:relative;}
        .screen{display:flex;flex-direction:column;width:100%;height:100%;background-color:var(--wa-dark-bg);position:absolute;top:0;left:0;transition:transform 0.3s ease-in-out;}
        .screen.hidden{transform:translateX(100%);}
        #chat-list-screen{transform:translateX(0);}
        .header-container{position:relative;flex-shrink:0;z-index:10;}
        .header{background-color:var(--wa-dark-header-bg);color:var(--wa-dark-text-primary);padding:15px;display:flex;align-items:center;gap:20px;box-shadow:0 2px 5px rgba(0,0,0,0.3);transition:opacity 0.2s;}
        .header.hidden{display:none;}
        #header-contextual{position:absolute;top:0;left:0;width:100%;box-sizing:border-box;}
        .header-icon{font-size:1.2rem;cursor:pointer;color:var(--wa-dark-text-secondary);}
        .header .fa-arrow-left{color:var(--wa-dark-text-primary);}
        .header-title{flex-grow:1;}
        .header-title h2{margin:0;font-size:1.2rem;font-weight:500;}
        .header-title p{margin:0;font-size:0.8rem;font-weight:300;color:var(--wa-dark-text-secondary);}
        .main-content{overflow-y:auto;flex-grow:1;}
        .fab{position:absolute;bottom:25px;right:25px;width:60px;height:60px;background-color:var(--wa-green-accent);border-radius:50%;display:flex;justify-content:center;align-items:center;color:white;font-size:1.5rem;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,0.4);transition:transform 0.2s,opacity 0.2s;z-index:20;}
        .fab.hidden{transform:scale(0);opacity:0;}
        .chat-list,.action-list{list-style:none;padding:0;margin:0;}
        .chat-item,.action-item{display:flex;align-items:center;padding:12px 15px;gap:20px;cursor:pointer;transition:background-color 0.2s;}
        .chat-item.selected{background-color:var(--wa-dark-selection);}
        .action-item:hover{background-color:var(--wa-dark-header-bg);}
        .chat-avatar{width:48px;height:48px;border-radius:50%;object-fit:cover;background-color:#333;flex-shrink:0;}
        .chat-avatar.is-group{background-color:#667781;display:flex;justify-content:center;align-items:center;font-size:1.5rem;color:var(--wa-dark-text-primary);}
        .chat-details{flex-grow:1;overflow:hidden;padding-right:10px;}
        .chat-name{color:var(--wa-dark-text-primary);font-size:1.1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .chat-last-message{color:var(--wa-dark-text-secondary);font-size:0.9rem;}
        .empty-chat-message{text-align:center;color:var(--wa-dark-text-secondary);margin-top:50px;font-size:1rem;}
        .action-icon{width:48px;height:48px;border-radius:50%;background-color:var(--wa-green-accent);color:white;display:flex;justify-content:center;align-items:center;font-size:1.2rem;}
        .action-text{color:var(--wa-dark-text-primary);font-size:1.1rem;font-weight:500;}
        .create-group-content{padding:25px;background-color:var(--wa-dark-header-bg);display:flex;align-items:center;gap:20px;}
        .group-photo-container{position:relative;cursor:pointer;}
        #photo-preview{width:70px;height:70px;border-radius:50%;background-color:#667781;object-fit:cover;}
        .camera-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--wa-dark-text-primary);font-size:2rem;}
        #photo-preview.has-image + .camera-icon{display:none;}
        #photo-upload{display:none;}
        .group-name-input{flex-grow:1;background:transparent;border:none;border-bottom:2px solid var(--wa-green-accent);padding:10px 0;font-size:1.1rem;outline:none;color:var(--wa-dark-text-primary);}
        .group-name-input::placeholder{color:var(--wa-dark-text-secondary);}
        .modal-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:100;opacity:1;transition:opacity 0.2s ease-in-out;}
        .modal-overlay.hidden{opacity:0;pointer-events:none;}
        .modal-content{background-color:var(--wa-dark-header-bg);padding:24px;border-radius:4px;box-shadow:0 5px 15px rgba(0,0,0,0.4);width:80%;max-width:320px;transform:scale(1);transition:transform 0.2s ease-in-out;}
        .modal-overlay.hidden .modal-content{transform:scale(0.95);}
        .modal-content h2{margin:0 0 16px 0;font-size:1.2rem;color:var(--wa-dark-text-primary);font-weight:500;}
        .modal-actions{display:flex;justify-content:flex-end;gap:20px;margin-top:24px;}
        .modal-actions button{background:none;border:none;color:var(--wa-green-accent);font-weight:700;font-size:0.9rem;cursor:pointer;padding:8px;text-transform:uppercase;}
    </style>
</head>
<body>
    <div class="whatsapp-container">
        <div id="chat-list-screen" class="screen">
            <div class="header-container">
                <div id="header-default" class="header"><div class="header-title"><h2>WhatsApp</h2></div><i class="fas fa-camera header-icon"></i><i class="fas fa-search header-icon"></i><i class="fas fa-ellipsis-v header-icon"></i></div>
                <div id="header-contextual" class="header hidden"><i id="contextual-back-arrow" class="fas fa-arrow-left header-icon"></i><div class="header-title"><h2>1</h2></div><i id="delete-icon" class="fas fa-trash header-icon"></i></div>
            </div>
            <div class="main-content"><ul id="groups-container" class="chat-list"></ul></div>
            <div id="fab-new-chat" class="fab"><i class="fas fa-plus"></i></div>
        </div>
        <div id="contact-list-screen" class="screen hidden">
            <div class="header"><i class="fas fa-arrow-left header-icon back-arrow"></i><div class="header-title"><h2>Nova conversa</h2></div><i class="fas fa-search header-icon"></i></div>
            <div class="main-content"><ul class="action-list"><li id="new-group-button" class="action-item"><div class="action-icon"><i class="fas fa-users"></i></div><span class="action-text">Novo grupo</span></li></ul></div>
        </div>
        <div id="new-group-screen" class="screen hidden">
            <div class="header"><i class="fas fa-arrow-left header-icon back-arrow"></i><div class="header-title"><h2>Novo grupo</h2><p>Adicionar dados</p></div></div>
            <div class="create-group-content"><div class="group-photo-container"><input type="file" id="photo-upload" accept="image/*"><img id="photo-preview" src="" alt=""><i class="fas fa-camera camera-icon"></i></div><input type="text" id="group-name" class="group-name-input" placeholder="Nome do grupo"></div>
            <div id="create-group-fab" class="fab"><i class="fas fa-check"></i></div>
        </div>
        <div id="confirmation-modal" class="modal-overlay hidden">
            <div class="modal-content"><h2>Apagar este grupo?</h2><div class="modal-actions"><button id="cancel-delete-btn">Cancelar</button><button id="confirm-delete-btn">Apagar</button></div></div>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, serverTimestamp, query, orderByChild, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        const firebaseConfig={apiKey:"AIzaSyDit6JdJfEescgLC1TP6WKdXSt41j492m0",authDomain:"mensagem4-46441.firebaseapp.com",databaseURL:"https://mensagem4-46441-default-rtdb.firebaseio.com",projectId:"mensagem4-46441",storageBucket:"mensagem4-46441.appspot.com",messagingSenderId:"14919682122",appId:"1:14919682122:web:94cad28d680d1a7d033eb3",measurementId:"G-RB6H9B31BV"};
        const app=initializeApp(firebaseConfig);
        const database=getDatabase(app);
        const screens={chatList:document.getElementById('chat-list-screen'),contactList:document.getElementById('contact-list-screen'),newGroup:document.getElementById('new-group-screen')};
        const fabNewChat=document.getElementById('fab-new-chat');
        const newGroupButton=document.getElementById('new-group-button');
        const backArrows=document.querySelectorAll('.back-arrow');
        let currentScreen='chatList';
        let selectedGroup={key:null, creatorId:null};
        const navigateTo=(screenName)=>{screens[currentScreen].classList.add('hidden');screens[screenName].classList.remove('hidden');currentScreen=screenName;};
        fabNewChat.addEventListener('click',()=>navigateTo('contactList'));
        newGroupButton.addEventListener('click',()=>navigateTo('newGroup'));
        backArrows.forEach(arrow=>{arrow.addEventListener('click',()=>{if(currentScreen==='newGroup')navigateTo('contactList');else if(currentScreen==='contactList')navigateTo('chatList');});});
        const photoContainer=document.querySelector('.group-photo-container');
        const photoUploadInput=document.getElementById('photo-upload');
        const photoPreview=document.getElementById('photo-preview');
        const groupNameInput=document.getElementById('group-name');
        const createGroupFab=document.getElementById('create-group-fab');
        photoContainer.addEventListener('click',()=>photoUploadInput.click());
        photoUploadInput.addEventListener('change',(event)=>{const file=event.target.files[0];if(file){const reader=new FileReader();reader.onload=(e)=>{photoPreview.src=e.target.result;photoPreview.classList.add('has-image');};reader.readAsDataURL(file);}});
        createGroupFab.addEventListener('click',()=>{const groupName=groupNameInput.value.trim();if(!groupName)return alert('Por favor, insira um nome para o grupo.');const userId=window.Android.getUserId();const userNickname=window.Android.getUserNickname();push(ref(database,'groups'),{name:groupName,photoURL:photoPreview.src||'',createdAt:serverTimestamp(),creatorId:userId,creatorNickname:userNickname}).then(()=>{groupNameInput.value='';photoPreview.src='';photoPreview.classList.remove('has-image');navigateTo('chatList');});});
        const headerDefault=document.getElementById('header-default');
        const headerContextual=document.getElementById('header-contextual');
        const contextualBackArrow=document.getElementById('contextual-back-arrow');
        const deleteIcon=document.getElementById('delete-icon');
        const confirmationModal=document.getElementById('confirmation-modal');
        const cancelDeleteBtn=document.getElementById('cancel-delete-btn');
        const confirmDeleteBtn=document.getElementById('confirm-delete-btn');
        const deselectGroup=()=>{const currentSelected=document.querySelector('.chat-item.selected');if(currentSelected)currentSelected.classList.remove('selected');selectedGroup={key:null,creatorId:null};headerDefault.classList.remove('hidden');headerContextual.classList.add('hidden');fabNewChat.classList.remove('hidden');};
        const selectGroup=(element,key,creatorId)=>{if(selectedGroup.key===key)return;deselectGroup();selectedGroup={key:key,creatorId:creatorId};element.classList.add('selected');headerDefault.classList.add('hidden');headerContextual.classList.remove('hidden');fabNewChat.classList.add('hidden');const currentUserId=(window.Android&&typeof window.Android.getUserId==='function')?window.Android.getUserId():null;if(currentUserId===creatorId){deleteIcon.style.display='block';}else{deleteIcon.style.display='none';}};
        contextualBackArrow.addEventListener('click',deselectGroup);
        deleteIcon.addEventListener('click',()=>{if(selectedGroup.key)confirmationModal.classList.remove('hidden');});
        cancelDeleteBtn.addEventListener('click',()=>confirmationModal.classList.add('hidden'));
        confirmationModal.addEventListener('click',(e)=>{if(e.target===confirmationModal)confirmationModal.classList.add('hidden');});
        confirmDeleteBtn.addEventListener('click',()=>{if(selectedGroup.key){remove(ref(database,'groups/'+selectedGroup.key));deselectGroup();}confirmationModal.classList.add('hidden');});
        const groupsContainer=document.getElementById('groups-container');
        const groupsQuery=query(ref(database,'groups'),orderByChild('createdAt'));
        onValue(groupsQuery,(snapshot)=>{groupsContainer.innerHTML='';if(snapshot.exists()){let groupsHtml='';snapshot.forEach((childSnapshot)=>{const group=childSnapshot.val();const groupKey=childSnapshot.key;const photoElement=group.photoURL?`<img src="${group.photoURL}" alt="Avatar" class="chat-avatar">`:`<div class="chat-avatar is-group"><i class="fas fa-users"></i></div>`;groupsHtml=`<li class="chat-item" data-key="${groupKey}" data-creator="${group.creatorId}">${photoElement}<div class="chat-details"><div class="chat-name">${group.name}</div><div class="chat-last-message">Criado por ${group.creatorNickname||'Admin'}</div></div></li>`+groupsHtml;});groupsContainer.innerHTML=groupsHtml;document.querySelectorAll('.chat-item').forEach(item=>{let pressTimer;const startPress=(e)=>{if(e.type==='mousedown'&&e.button!==0)return;pressTimer=window.setTimeout(()=>{selectGroup(item,item.dataset.key,item.dataset.creator);},500);};const cancelPress=()=>clearTimeout(pressTimer);item.addEventListener('mousedown',startPress);item.addEventListener('mouseup',cancelPress);item.addEventListener('mouseleave',cancelPress);item.addEventListener('touchstart',startPress,{passive:true});item.addEventListener('touchend',cancelPress);item.addEventListener('touchmove',cancelPress);item.addEventListener('click',()=>{if(!selectedGroup.key){const key=item.getAttribute('data-key');if(window.Android&&typeof window.Android.openChat==='function'){window.Android.openChat(key);}else{window.location.href=`chat.html?id=${key}`;}}});});}else{groupsContainer.innerHTML='<p class="empty-chat-message">Pressione + para criar um grupo</p>';deselectGroup();}});
    </script>
</body>
</html>
