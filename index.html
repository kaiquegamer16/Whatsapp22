<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root{--wa-dark-bg:#111B21;--wa-dark-header-bg:#202C33;--wa-dark-text-primary:#E9EDEF;--wa-dark-text-secondary:#8696A0;--wa-green-accent:#00A884;--wa-dark-selection:#2a3942;--font-family:'Roboto',sans-serif;}
        html,body{height:100%;margin:0;padding:0;-webkit-user-select:none;user-select:none;}
        body{font-family:var(--font-family);background-color:#0b141a;display:flex;justify-content:center;align-items:center;height:100vh;}
        .whatsapp-container{width:100%;max-width:450px;height:100%;max-height:90vh;background-color:var(--wa-dark-bg);display:flex;flex-direction:column;box-shadow:0 5px 25px rgba(0,0,0,0.5);border-radius:8px;overflow:hidden;position:relative;}
        .screen{display:flex;flex-direction:column;width:100%;height:100%;background-color:var(--wa-dark-bg);position:absolute;top:0;left:0;transition:transform 0.3s ease-in-out;}
        .screen.hidden{transform:translateX(100%);}
        #chat-list-screen{transform:translateX(0);}
        .header-container{position:relative;flex-shrink:0;z-index:10;}
        .header{background-color:var(--wa-dark-header-bg);color:var(--wa-dark-text-primary);padding:15px;display:flex;align-items:center;gap:20px;box-shadow:0 2px 5px rgba(0,0,0,0.3);transition:opacity 0.2s;}
        .header.hidden{display:none;}
        .header-icon{font-size:1.2rem;cursor:pointer;color:var(--wa-dark-text-secondary);}
        .header .fa-arrow-left{color:var(--wa-dark-text-primary);}
        .header-title{flex-grow:1;}
        .header-title h2{margin:0;font-size:1.2rem;font-weight:500;}
        .main-content{overflow-y:auto;flex-grow:1;}
        .fab{position:absolute;bottom:25px;right:25px;width:60px;height:60px;background-color:var(--wa-green-accent);border-radius:50%;display:flex;justify-content:center;align-items:center;color:white;font-size:1.5rem;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,0.4);transition:transform 0.2s,opacity 0.2s;z-index:20;}
        .fab.hidden{transform:scale(0);opacity:0;}
        .chat-list,.action-list{list-style:none;padding:0;margin:0;}
        .chat-item,.action-item{display:flex;align-items:center;padding:12px 15px;gap:20px;cursor:pointer;transition:background-color 0.2s;}
        .chat-item.selected{background-color:var(--wa-dark-selection);}
        .action-item:hover{background-color:var(--wa-dark-header-bg);}
        .chat-avatar{width:48px;height:48px;border-radius:50%;object-fit:cover;background-color:#333;flex-shrink:0;}
        .chat-avatar.is-group{background-color:#667781;display:flex;justify-content:center;align-items:center;font-size:1.5rem;color:var(--wa-dark-text-primary);}
        .chat-details{flex-grow:1;overflow:hidden;padding-right:10px;}
        .chat-name{color:var(--wa-dark-text-primary);font-size:1.1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .chat-last-message{color:var(--wa-dark-text-secondary);font-size:0.9rem;}
        .list-header{color:var(--wa-green-accent);font-size:0.9rem;font-weight:700;padding:20px 15px 8px;text-transform:uppercase;border-top:1px solid var(--wa-dark-header-bg);margin-top:10px;}
        .action-icon{width:48px;height:48px;border-radius:50%;background-color:var(--wa-green-accent);color:white;display:flex;justify-content:center;align-items:center;font-size:1.2rem;}
        .action-text{color:var(--wa-dark-text-primary);font-size:1.1rem;font-weight:500;}
        .form-content{padding:25px;display:flex;flex-direction:column;gap:20px;}
        .form-content input{background:transparent;border:none;border-bottom:2px solid var(--wa-green-accent);padding:10px 0;font-size:1.1rem;outline:none;color:var(--wa-dark-text-primary);}
        .form-content input::placeholder{color:var(--wa-dark-text-secondary);}
        .modal-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:100;opacity:1;transition:opacity 0.2s ease-in-out;}
        .modal-overlay.hidden{opacity:0;pointer-events:none;}
        .modal-content{background-color:var(--wa-dark-header-bg);padding:24px;border-radius:4px;width:80%;max-width:320px;}
        .modal-actions{display:flex;justify-content:flex-end;gap:20px;margin-top:24px;}
        .modal-actions button{background:none;border:none;color:var(--wa-green-accent);font-weight:700;font-size:0.9rem;cursor:pointer;}
    </style>
</head>
<body>
    <div class="whatsapp-container">
        <div id="chat-list-screen" class="screen">
            <div class="header-container"><div id="header-default" class="header"><div class="header-title"><h2>WhatsApp</h2></div><i id="my-id-btn" class="fas fa-id-card header-icon"></i><i class="fas fa-search header-icon"></i></div></div>
            <div class="main-content"><ul id="groups-container" class="chat-list"></ul><div id="contacts-header" class="list-header hidden">Conversas</div><ul id="contacts-container" class="chat-list"></ul></div>
            <div id="fab-new-chat" class="fab"><i class="fas fa-plus"></i></div>
        </div>
        <div id="new-conversation-screen" class="screen hidden">
            <div class="header"><i class="fas fa-arrow-left header-icon back-arrow"></i><div class="header-title"><h2>Nova Conversa</h2></div></div>
            <div class="main-content"><ul class="action-list"><li id="new-group-btn" class="action-item"><div class="action-icon"><i class="fas fa-users"></i></div><span class="action-text">Novo grupo</span></li><li id="new-contact-btn" class="action-item"><div class="action-icon"><i class="fas fa-user-plus"></i></div><span class="action-text">Novo contato</span></li></ul></div>
        </div>
        <div id="new-group-screen" class="screen hidden">
            <div class="header"><i class="fas fa-arrow-left header-icon back-arrow"></i><div class="header-title"><h2>Novo grupo</h2></div></div>
            <div class="form-content"><input type="text" id="group-name" placeholder="Nome do grupo"></div>
            <div id="create-group-fab" class="fab"><i class="fas fa-check"></i></div>
        </div>
        <div id="new-contact-screen" class="screen hidden">
            <div class="header"><i class="fas fa-arrow-left header-icon back-arrow"></i><div class="header-title"><h2>Novo Contato</h2></div></div>
            <div class="form-content"><input type="text" id="contact-nickname" placeholder="Nickname do Contato"><input type="text" id="contact-id" placeholder="ID de UsuÃ¡rio do Contato"></div>
            <div id="save-contact-fab" class="fab"><i class="fas fa-check"></i></div>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, serverTimestamp, query, orderByChild } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        const firebaseConfig={apiKey:"AIzaSyDit6JdJfEescgLC1TP6WKdXSt41j492m0",authDomain:"mensagem4-46441.firebaseapp.com",databaseURL:"https://mensagem4-46441-default-rtdb.firebaseio.com",projectId:"mensagem4-46441",storageBucket:"mensagem4-46441.appspot.com",messagingSenderId:"14919682122",appId:"1:14919682122:web:94cad28d680d1a7d033eb3",measurementId:"G-RB6H9B31BV"};
        const app=initializeApp(firebaseConfig);
        const database=getDatabase(app);
        const screens={chatList:document.getElementById('chat-list-screen'),newConversation:document.getElementById('new-conversation-screen'),newGroup:document.getElementById('new-group-screen'),newContact:document.getElementById('new-contact-screen')};
        let currentScreen='chatList';
        const navigateTo=(screenName)=>{screens[currentScreen].classList.add('hidden');screens[screenName].classList.remove('hidden');currentScreen=screenName;};
        document.getElementById('fab-new-chat').addEventListener('click',()=>navigateTo('newConversation'));
        document.getElementById('new-group-btn').addEventListener('click',()=>navigateTo('newGroup'));
        document.getElementById('new-contact-btn').addEventListener('click',()=>navigateTo('newContact'));
        document.querySelectorAll('.back-arrow').forEach(arrow=>{arrow.addEventListener('click',()=>{if(currentScreen==='newGroup'||currentScreen==='newContact')navigateTo('newConversation');else if(currentScreen==='newConversation')navigateTo('chatList');});});
        document.getElementById('create-group-fab').addEventListener('click',()=>{const groupName=document.getElementById('group-name').value.trim();if(!groupName)return;const userId=window.Android.getUserId();const userNickname=window.Android.getUserNickname();push(ref(database,'groups'),{name:groupName,createdAt:serverTimestamp(),creatorId:userId,creatorNickname:userNickname}).then(()=>{document.getElementById('group-name').value='';navigateTo('chatList');});});
        document.getElementById('save-contact-fab').addEventListener('click',()=>{const nickname=document.getElementById('contact-nickname').value.trim();const id=document.getElementById('contact-id').value.trim();if(!nickname||!id)return;window.Android.saveContact(JSON.stringify({id,nickname}));document.getElementById('contact-nickname').value='';document.getElementById('contact-id').value='';navigateTo('chatList');renderContacts();});
        document.getElementById('my-id-btn').addEventListener('click', () => { if(window.Android?.showMyId) window.Android.showMyId(); });
        const groupsContainer=document.getElementById('groups-container');
        const contactsContainer=document.getElementById('contacts-container');
        const contactsHeader=document.getElementById('contacts-header');
        const renderChats=()=>{const groupsQuery=query(ref(database,'groups'),orderByChild('createdAt'));onValue(groupsQuery,(snapshot)=>{groupsContainer.innerHTML='';if(snapshot.exists()){snapshot.forEach((childSnapshot)=>{const group=childSnapshot.val();const groupKey=childSnapshot.key;const item=document.createElement('li');item.className='chat-item';item.dataset.key=groupKey;item.dataset.name=group.name;item.dataset.type='group';item.innerHTML=`<div class="chat-avatar is-group"><i class="fas fa-users"></i></div><div class="chat-details"><div class="chat-name">${group.name}</div><div class="chat-last-message">Criado por ${group.creatorNickname||'Admin'}</div></div>`;groupsContainer.prepend(item);});}renderContacts();});};
        const renderContacts=()=>{contactsContainer.innerHTML='';const contactsJson=window.Android.getContacts();const contacts=JSON.parse(contactsJson);if(contacts.length>0){contactsHeader.classList.remove('hidden');contacts.forEach(contact=>{const item=document.createElement('li');item.className='chat-item';item.dataset.key=contact.id;item.dataset.name=contact.nickname;item.dataset.type='private';item.innerHTML=`<div class="chat-avatar"><i class="fas fa-user"></i></div><div class="chat-details"><div class="chat-name">${contact.nickname}</div><div class="chat-last-message">Conversa Privada</div></div>`;contactsContainer.appendChild(item);});}else{contactsHeader.classList.add('hidden');}addClickListenersToItems();};
        const addClickListenersToItems=()=>{document.querySelectorAll('.chat-item').forEach(item=>{item.addEventListener('click',()=>{const chatInfo={id:item.dataset.key,name:item.dataset.name,type:item.dataset.type};if(window.Android?.openChat){window.Android.openChat(JSON.stringify(chatInfo));}});});};
        renderChats();
    </script>
</body>
</html>
